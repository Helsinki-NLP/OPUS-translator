{% extends "base.html" %}
{% block content %}

<body>
  <div class="container">
    
    <h4>Translate</h4>
    
    <select id="direction">
      <option value="en-de">en-de</option>
      <option value="en-fr">en-fr</option>
      <option value="da-fi">da-fi</option>
      <option value="no-fi">no-fi</option>
      <option value="sv-fi">sv-fi</option>
    </select>
    <button id="translate">Translate</button>
    <br>
    <br>
    <div overflow="hidden">
      <div style="float: left;">
	<textarea id="sentence" maxlength="500" rows="4" cols="30" style="font-size: 20px"></textarea>
      </div>
      <div style="margin-left: 450px;">
	<textarea id="translation" rows="4" cols="30" style="color: black; font-size: 20px;" disabled></textarea>
      </div>
    </div>
    <br>
    <br>
    <button id="suggestionbutton" style="visibility: hidden">Suggest a better translation</button>
    <br>
    <br>
    <div id="asksuggestion" style="visibility: hidden;" overflow="hidden">
      <div style="float: left;">
	<span>Source text:</span>
	<br>
	<textarea id="source" rows="4" cols="30" style="color: black; font-size: 20px;" disabled></textarea>
      </div>
      <div style="margin-left: 450px">
	<span>Your translation:</span>
	<br>
	<textarea id="suggestion" maxlength="500" rows="4" cols="30" style="font-size: 20px;"></textarea>
      </div>
    </div>
    <br>
    <button id="suggest" style="visibility: hidden">Suggest</button>
    <span style="visibility: hidden" id="sourcedirection"></span>
  </div>
</body>

<script src="static/jquery-3.3.1.min.js"> </script>
<script type="text/javascript">
    function translate() {
	$("#asksuggestion").css("visibility", "hidden");
	$("#source").text("");
	$("#suggestion").css("visibility", "hidden");
	$("#suggestion").val("");
	$("#suggest").css("visibility", "hidden");
	var sentence = $("#sentence").val();
	var direction = $("#direction").val();
	if ($.trim(sentence) != "") {
	    $("#translation").css("font-style", "italic");
	    $("#translation").text("Translating...");
	    $.getJSON("https://vm1617.kaj.pouta.csc.fi/translate", {
		sent: sentence,
		direction: direction
	    }, function(data) {
		$("#suggestionbutton").css("visibility", "visible");
		$("#source").val(sentence);
		$("#sourcedirection").text(direction);
		$("#status").text("");
		$("#translation").css("font-style", "normal");
		$("#translation").text(data.result);
	    });
	    return false;
	} else {
	    $("#translation").text("");
	    $("#suggestionbutton").css("visibility", "hidden");
	}
    }

    $("#translate").on("click", function() {
	translate();
    });
    
    $("#sentence").keyup(function(ev) {
	if (ev.ctrlKey && ev.which === 13) {
	    translate();
	}
    });
    
    $("#direction").on('change', function() {
	translate();
    });

    function suggest() {
	$.getJSON("https://vm1617.kaj.pouta.csc.fi/suggest", {
	    direction: $("#sourcedirection").text(),
	    source: $("#source").val(),
	    suggestion: $("#suggestion").val()
	});
	$("#asksuggestion").text("Translation added!");
	$("#suggestion").css("visibility", "hidden");
	$("#suggest").css("visibility", "hidden");
    }

    $("#suggest").on("click", function() {
	suggest();
    });

    $("#suggestion").keyup(function(ev) {
	if (ev.which === 13) {
	    suggest();
	}
    });

    $("#suggestionbutton").on("click", function() {
	$("#asksuggestion").css("visibility", "visible");
	$("#suggestion").css("visibility", "visible");
	$("#suggest").css("visibility", "visible");
    });
    
</script>
{% endblock %}
